{{ define "header" }}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>
        {{ .Title }}
    </title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <link rel="stylesheet" href="/static/style.css">  
</head>
<body>
    <div class="container">
{{ end }}

{{ define "footer" }}
</div>
</body>
</html>
{{ end }}


{{ define "useraddform" }}
<p>{{ .Title }}</p>
<br>
<form id="useraddform">
Email: <input type="text" id="email" name="Email" placeholder="user@example.com"/><br>
Password: <input type="password" id="password" name="Password" placeholder="secret password"/><br>
Repeat Password <input type="password" id="repeatpassword" name="RepeatPassword" placeholder="repeat secret password"/><br>
    <input type="submit" value="Create">
</form>

<script>
    useraddform.onsubmit = async (e) => {
        e.preventDefault();
        var form = document.querySelector("#useraddform");
        data = {
            login : form.querySelector('input[name="Email"]').value,
            password : form.querySelector('input[name="Password"]').value,
        };
        $.ajax({
        url: "/signup",
        method: "POST",
        data: JSON.stringify(data),
        headers: {'Content-Type': 'application/json'},
        success : function () {
          window.location.href = "/login/";
        }
      });
    }
    
</script>

{{ end }}


{{ define "addtunnel" }}
<p class="text-monospace"> Add new tunnel  </p>
<form id="addtunnel">            
<table border="1">
    <tr>
        <td>Name</td>
        <td> <input type="text" id="TunnelName" name="TunnelName" value="webtunnel"> </td>
    </tr>
    <tr>
        <td>IPv4 Client address</td>
        
        <td> <input type="text" id="IPv4Remote" name="IPv4Remote" placeholder="184.23.14.15" value="184.23.14.15"> </td>
    </tr> 
    <tr>
        <td colspan="2" align="center">
            <button type="submit">Create</button>
        </td>
    </tr>               
</table>
</form>
<script>
addtunnel.onsubmit = async (e) => {
    e.preventDefault();
    var form = document.querySelector("#addtunnel");
    data = {
        TunnelName : form.querySelector('input[name="TunnelName"]').value,
        IPv4Remote : form.querySelector('input[name="IPv4Remote"]').value,
        };
    $.ajax({
    url: "/tunnel/{{ .User.API }}/",
    method: "POST",
    data: JSON.stringify(data),
    headers: {'Content-Type': 'application/json'},
    success : function () {
      window.location.href = "/user/";
    }
  });
}
</script>
{{ end }}

{{ define "addtunnel2" }}
<p class="text-monospace"> Add new tunnel  </p>
<form id="addtunnel" class="text-monospace">            
    <div class="form-group row w-50">
        <label for="TunnelName" class="col-sm-3 col-form-label ">Tunnel name</label>
        <div class="col-sm-5">
            <input type="text" class="form-control" id="TunnelName" name="TunnelName" placeholder="My tunnel name">
        </div>
      </div>
      <div class="form-group row w-50">
        <label for="IPv4Remote" class="col-sm-3 col-form-label">IPv4 client address</label>
        <div class="col-sm-5 mt-3">
          <input type="text" class="form-control" id="IPv4Remote" name="IPv4Remote" placeholder="185.123.11.3">
        </div>
      </div> 
      <button type="submit" class="btn btn-success">Add new tunnel</button> 

</form>
<script>
addtunnel.onsubmit = async (e) => {
    e.preventDefault();
    var form = document.querySelector("#addtunnel");
    data = {
        TunnelName : form.querySelector('input[name="TunnelName"]').value,
        IPv4Remote : form.querySelector('input[name="IPv4Remote"]').value,
        };
    $.ajax({
    url: "/tunnel/{{ .User.API }}/",
    method: "POST",
    data: JSON.stringify(data),
    headers: {'Content-Type': 'application/json'},
    success : function () {
      window.location.href = "/user/";
    }
  });
};
function getPublicIP() {
  fetch('http://httpbin.org/ip')
    .then(response => response.json())
    .then(data => {
        IPv4Remote.value = data.origin
      console.log(data.origin);
    });
}
window.onload = getPublicIP()
</script>
{{ end }}

{{ define "ListTunnels" }}

    {{ if .User.Tunnels }}
        {{range $index, $element := .User.Tunnels }}
        
        <table border="1" class="table table-bordered mt-5 w-50 text-monospace">
        <tr>
            <th> ID </th>
            <td> {{ $element.ID }}  </td>
        </tr>
        <tr>
            <th> Tunnel Name </th>
            <td> {{ $element.TunnelName }}  </td>
        </tr>
        <tr>
            <th> IPv4 Client address</th>
            <td> {{ $element.IPv4Remote }}  </td>
        </tr>
        <tr>
            <th> IPv4 Server address </th>
            <td> {{ $element.IPv4Local }}  </td>
        </tr>
        <tr>
            <th> IPv6 P2P network </th>
            <td> {{ $element.P2P }}  </td>
        </tr>    
        <tr>
            <th> IPv6 PD prefix </th>
            <td> {{ $element.PD }}  </td>
        </tr>    
        <tr>
            <th> Already configured </th>
            <td> {{ $element.Configured }}  </td>
        </tr>
        <tr>
            <th> Action </th>
            <td> <button class="control-action btn btn-danger" id="{{ $element.ID }}">Delete</button>  </td>
        </tr>
        </table>      
        <br>        
        {{end}}
    {{ else }}
        <p class="text-monospace">There is no configured tunnel</p>
    {{ end }}
<script>
    $(".control-action").on("click", function(e)  {
  $.ajax({
    url: "/tunnel/{{ .User.API }}/"+this.id,
    method: "DELETE",
    success : function () {
      window.location.href = "/user/";
    }
  });
});
</script>
{{ end }}


{{ define "LoginForm" }}

    <p>{{ .Title }}</p>
    <br>
    <form id="loginform" method="POST" action="/login">
    <table>
        <tr>
            <td>Login</td>
            <td><input type="text" id="email" name="Email" placeholder="user@example.com"/></td>
        </tr>
        <tr>
            <td>Password</td>
            <td><input type="password" id="password" name="Password" placeholder="password"/></td>
        </tr>
        <tr>
            <td colspan="2" align="center"> 
                <button type="submit">Login</button> 
                </td>
        </tr>
    </table>    
    </form>
    <a href="/signup"><button>Register</button></a> 

{{ end }}


{{ define "LoginForm2" }}
<p class="h1 mt-5">{{ .Title }}</p>
    <br>
<form id="loginform" method="POST" action="/login">
    <div class="form-group w-25" >
      <label for="exampleInputEmail1">Email address</label>
      <input type="email" class="form-control" id="exampleInputEmail1" name="Email" aria-describedby="emailHelp" placeholder="Enter email">
    </div>
    <div class="form-group  w-25">
      <label for="exampleInputPassword1">Password</label>
      <input type="password" class="form-control" id="exampleInputPassword1" name="Password" placeholder="Password">
    </div>
    <button type="submit" class="btn btn-success">Login</button> 
    <input type="button" onclick="location.href='/signup';"   class="btn btn-warning" value="Register" />
  </form>
  
{{ end }}