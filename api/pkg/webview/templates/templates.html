{{ define "header" }}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>
        {{ .Title }}
    </title>
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"> -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script> -->
    <link rel="stylesheet" href="/static/bootstrap.min.css"/>
    <script src="/static/jquery.min.js"></script>
    <link rel="stylesheet" href="/static/style.css">  
</head>
<body>
    <div class="container">
{{ end }}

{{ define "footer" }}
</div>
</body>
</html>
{{ end }}


{{ define "useraddform" }}

<p class="h1 mt-5">{{ .Title }}</p>
    <br>
<form id="useraddform" method="POST" action="/signup">
    <input type="hidden" name="csrf_token" value="{{ .Token }}">
    <div class="form-group w-25" >
      <label for="exampleInputEmail1">Email address</label>
      <input type="email" class="form-control" id="exampleInputEmail1" name="Email" aria-describedby="emailHelp" placeholder="Enter email">
    </div>
    <div class="form-group  w-25">
      <label for="exampleInputPassword1">Password</label>
      <input type="password" class="form-control" id="exampleInputPassword1" name="Password" placeholder="Password">
    </div>
    <div class="form-group  w-25">
        <label for="exampleInputPassword1">Repeat Password</label>
        <input type="password" class="form-control" id="exampleInputPassword1" name="repPassword" placeholder="Repeat Password">
        
    </div>    
    {{ if .Error }}
    <p>Error: {{ .Error }}</p>
    {{ end}}
    <div id="message"></div>
    <button type="submit" class="btn btn-success">Create</button> 
  </form>
  

<script>
    useraddform.onsubmit = async (e) => {
        e.preventDefault();
        var form = document.querySelector("#useraddform");
        const email = form.querySelector('input[name="Email"]').value;
        const password = form.querySelector('input[name="Password"]').value;
        const rpassword = form.querySelector('input[name="repPassword"]').value;
        const token = form.querySelector('input[name="csrf_token"]').value;
        const message = document.querySelector('#message'); 
        if (password!==rpassword) {
            message.innerHTML="Passwords do not match";
            return;
        }
        data = {
            login : email,
            password : password,
        };
        console.log(data);
        $.ajax({
        url: "/signup",
        method: "POST",
        data: JSON.stringify(data),
        headers: {
            'Content-Type': 'application/json',
            'X-CSRF-TOKEN': token,
        },
        success : function () {
            message.innerHTML="User is created. Redirecting to login page";
            setTimeout(function() {
                window.location.href = "/login/";
            }, 5000);
        }
      });
    }
    
</script>

{{ end }}


{{ define "addtunnel" }}
<p class="text-monospace"> Add new tunnel  </p>
<form id="addtunnel">
    <input type="hidden" name="csrf_token" value="{{ .Token }}">         
<table border="1">
    <tr>
        <td>Name</td>
        <td> <input type="text" id="TunnelName" name="TunnelName" value="webtunnel"> </td>
    </tr>
    <tr>
        <td>IPv4 Client address</td>
        
        <td> <input type="text" id="IPv4Remote" name="IPv4Remote" placeholder="184.23.14.15" value="184.23.14.15"> </td>
    </tr> 
    <tr>
        <td colspan="2" align="center">
            <button type="submit">Create</button>
        </td>
    </tr>               
</table>
</form>
<script>
addtunnel.onsubmit = async (e) => {
    e.preventDefault();
    var form = document.querySelector("#addtunnel");
    const token = form.querySelector('input[name="csrf_token"]').value;
    data = {
        TunnelName : form.querySelector('input[name="TunnelName"]').value,
        IPv4Remote : form.querySelector('input[name="IPv4Remote"]').value,
        };
    $.ajax({
    url: "/tunnel/{{ .User.API }}/",
    method: "POST",
    data: JSON.stringify(data),
    headers: {
            'Content-Type': 'application/json',
            'X-CSRF-TOKEN': token,
        },
    success : function () {
      window.location.href = "/user/";
    }
  });
}
</script>
{{ end }}

{{ define "addtunnel2" }}
<p class="text-monospace"> Add new tunnel  </p>
<form id="addtunnel" class="text-monospace">
    <input type="hidden" name="csrf_token" value="{{ .Token }}">
    <div class="form-group row w-50">
        <label for="TunnelName" class="col-sm-3 col-form-label ">Tunnel name</label>
        <div class="col-sm-5">
            <input type="text" class="form-control" id="TunnelName" name="TunnelName" placeholder="My tunnel name">
        </div>
      </div>
      <div class="form-group row w-50">
        <label for="IPv4Remote" class="col-sm-3 col-form-label">IPv4 client address</label>
        <div class="col-sm-5 mt-3">
          <input type="text" class="form-control" id="IPv4Remote" name="IPv4Remote" placeholder="185.123.11.3">
        </div>
      </div> 
      <button type="submit" class="btn btn-success">Add new tunnel</button> 

</form>
<script>
addtunnel.onsubmit = async (e) => {
    e.preventDefault();
    var form = document.querySelector("#addtunnel");
    const token = form.querySelector('input[name="csrf_token"]').value;
    data = {
        TunnelName : form.querySelector('input[name="TunnelName"]').value,
        IPv4Remote : form.querySelector('input[name="IPv4Remote"]').value,
        };
    $.ajax({
    url: "/tunnel/{{ .User.API }}/",
    method: "POST",
    data: JSON.stringify(data),
    headers: {
            'Content-Type': 'application/json',
            'X-CSRF-TOKEN': token,
        },
    success : function () {
      window.location.href = "/user/";
    }
  });
};
function getPublicIP() {
  fetch('http://httpbin.org/ip')
    .then(response => response.json())
    .then(data => {
        IPv4Remote.value = data.origin
    });
}
window.onload = getPublicIP()
</script>
{{ end }}

{{ define "ListTunnels" }}

    {{ if .User.Tunnels }}
    <input type="hidden" name="csrf_token" value="{{ .Token }}">

        {{range $index, $element := .User.Tunnels }}
        
        <table border="1" class="table table-bordered mt-5 w-50 text-monospace">
        <tr>
            <th> ID </th>
            <td> {{ $element.ID }}  </td>
        </tr>
        <tr>
            <th> Tunnel Name </th>
            <td> {{ $element.TunnelName }}  </td>
        </tr>
        <tr>
            <th> IPv4 Client address</th>
            <td> {{ $element.IPv4Remote }}  </td>
        </tr>
        <tr>
            <th> IPv4 Server address </th>
            <td> {{ $element.IPv4Local }}  </td>
        </tr>
        <tr>
            <th> IPv6 client address </th>
            <td> {{ $element.IPv6ClientEndpoint }}  </td>
        </tr>    
        <tr>
            <th> IPv6 server address </th>
            <td> {{ $element.IPv6ServerEndpoint }}  </td>
        </tr>    

        <tr>
            <th> IPv6 PD prefix </th>
            <td> {{ $element.PD }}  </td>
        </tr>    
        <tr>
            <th> Already configured </th>
            <td> {{ $element.Configured }}  </td>
        </tr>
        <tr>
            <th> Action </th>
            <td> <button class="control-action btn btn-danger" id="{{ $element.ID }}">Delete</button>  </td>
        </tr>
        </table>      
        <br>        
        {{end}}
    {{ else }}
        <p class="text-monospace">There is no configured tunnel</p>
    {{ end }}
<script>
    const token = document.querySelector('input[name="csrf_token"]').value;

    $(".control-action").on("click", function(e)  {
  $.ajax({
    url: "/tunnel/{{ .User.API }}/"+this.id,
    method: "DELETE",
    headers: {
            'Content-Type': 'application/json',
            'X-CSRF-TOKEN': token,
        },
    success : function () {
      window.location.href = "/user/";
    }
  });
});
</script>
{{ end }}


{{ define "LoginForm" }}
<p class="h1 mt-5">{{ .Title }}</p>
    <br>
<form id="loginform" method="POST" action="/login">
    <input type="hidden" name="csrf_token" value="{{ .Token }}">

    <div class="form-group w-25" >
      <label for="exampleInputEmail1">Email address</label>
      <input type="email" class="form-control" id="exampleInputEmail1" name="Email" aria-describedby="emailHelp" placeholder="Enter email">
    </div>
    <div class="form-group  w-25">
      <label for="exampleInputPassword1">Password</label>
      <input type="password" class="form-control" id="exampleInputPassword1" name="Password" placeholder="Password">
    </div>
    {{ if .Error }}
    <p>Error: {{ .Error }}</p>
    {{ end}}
    <div id="message"></div>
    <button type="submit" class="btn btn-success">Login</button> 
    <input type="button" onclick="location.href='/signup';"   class="btn btn-warning" value="Register" />
  </form>
  <script>
    loginform.onsubmit = async (e) => {
        e.preventDefault();
        var form = document.querySelector("#loginform");
        const email = form.querySelector('input[name="Email"]').value;
        const pass = form.querySelector('input[name="Password"]').value;
        const message = document.querySelector('#message'); 
        const token = form.querySelector('input[name="csrf_token"]').value;

        if (email.length <=3  ||  pass.length <=3) {
            message.innerHTML="Check the email and password value"
            return 
        }
        data = {
            login : email,
            password : pass,
            };
        $.ajax({
        url: "/login",
        method: "POST",
        data: JSON.stringify(data),
        headers: {
            'Content-Type': 'application/json',
            'X-CSRF-TOKEN': token,
        },
        success : function () {
          window.location.href = "/user/";
        }
      });
    };
    </script>
{{ end }}